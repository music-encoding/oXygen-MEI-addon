<?xml version="1.0" encoding="UTF-8"?>
<project basedir="." name="oXygen-MEI-addon" default="dist">
  
  <!-- import default properties from file -->
  <property file="build.properties"/>
  <property file="local.build.properties"/>
  
  <target name="init">
    <mkdir dir="${build.dir}"/>
  </target>
  
  <target name="clean">
    <delete dir="${build.dir}"/>
  </target>
  
  <target name="clean.assets">
    <delete dir="assets/"/>
  </target>
  
  <target name="get-local-git-revision">
    <description>Get the current git revision</description>
    <exec executable="git" outputproperty="local.revision">
      <arg value="describe"/>
      <arg value="--tags"/>
      <arg value="--always"/>
      <arg value="HEAD"/>
    </exec>
    <echo>Local revision: ${local.revision}</echo>
  </target>
  
  <target name="v3.0.0">
    <!-- create assets directories -->
    <mkdir dir="temp/v3.0.0/" />
    <mkdir dir="assets/music-encoding/v3.0.0/schemata/"/>
    <mkdir dir="assets/music-encoding/v3.0.0/guidelines/"/>
    <!-- get schemata to temp -->
    <get verbose="on" src="https://github.com/music-encoding/music-encoding/releases/download/v3.0.0/MEI.3.0.0.Schemata.only.zip" dest="temp/v3.0.0/"/>
    <!-- unzip schemata -->
    <unzip src="temp/v3.0.0/MEI.3.0.0.Schemata.only.zip" dest="assets/music-encoding/v3.0.0/schemata/"/>
    <!-- download guidelines to assets directory -->
    <get verbose="on" src="https://github.com/music-encoding/music-encoding/releases/download/v3.0.0/MEI_Guidelines_v3.0.0.pdf" dest="assets/music-encoding/v3.0.0/guidelines/"/>
    <!-- cleanup temp -->
    <delete dir="temp/v3.0.0/"/>
  </target>

  <target name="v2.1.1">
    <!-- create assets directories -->
    <mkdir dir="temp/v2.1.1/" />
    <mkdir dir="assets/music-encoding/v2.1.1/schemata/"/>
    <mkdir dir="assets/music-encoding/v2.1.1/guidelines/"/>
    <!-- get source to temp -->
    <get verbose="on" src="https://github.com/music-encoding/music-encoding/archive/MEI2013_v2.1.1.zip" dest="temp/v2.1.1/"/>
    <!-- unzip schemata -->
    <unzip src="temp/v2.1.1/MEI2013_v2.1.1.zip" dest="assets/music-encoding/v2.1.1/schemata/">
      <patternset>
        <include name="*/schemata/*"/>
      </patternset>
      <mapper type="flatten"/>
    </unzip>
    <!-- unzip guidelines -->
    <unzip src="temp/v2.1.1/MEI2013_v2.1.1.zip" dest="assets/music-encoding/v2.1.1/guidelines/">
      <patternset>
        <include name="*/guidelines/*"/>
      </patternset>
      <mapper type="flatten"/>
    </unzip>
    <!-- cleanup temp -->
    <delete dir="temp/v2.1.1/"/>
  </target>

  <target name="frameworks.init">
    <antcall target="v2.1.1"/>
    <antcall target="v3.0.0"/>
  </target>
  
  <target name="dist">
    <antcall target="frameworks.init"/>
  </target>
</project>